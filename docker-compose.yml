version: "3.6"
services:
  viewpicam:
    image: cyr-ius/viewpicam:latest
    # build:
    #   context: .
    #   dockerfile: ./Dockerfile    
    container_name: viewpicam
    restart: unless-stopped
    environment:
      - SECRET_KEY=123456789
    ports:
      - 8000:8000/tcp
    volumes:
      - static_volume:/app/static
      - ./medias:/app/media:rw      
      - /opt/vc:/opt/vc
      - /dev/vchiq:/dev/vchiq
      - /dev/vcsm:/dev/vcsm
  web:
    image: nginx:stable-alpine
    restart: unless-stopped
    depends_on:
      - viewpicam
    volumes:
      - static_volume:/var/www/html/static
      - ./medias:/var/www/html/static/media
      - ./site.conf:/etc/nginx/conf.d/default.conf:ro
      - /etc/timezone:/etc/timezone:ro   
    ports:
      - 80:80

volumes:
  static_volume:  
  
# Onliner
# mkdir -p /mnt/data/media /mnt/data/h264 /mnt/data/macros /mnt/data/system
# docker pull ghcr.io/cyr-ius/viewpi-cam:latest
# docker run -d --privileged -p 80:8000 -e SECRET_KEY="123456" -e FLASK_DEBUG=1 -e LOG_LEVEL=DEBUG -v /mnt/data/media:/app/media -v /mnt/data/system:/app/system --name viewpicam ghcr.io/cyr-ius/viewpi-cam:latest
# docker logs viewpicam -f
